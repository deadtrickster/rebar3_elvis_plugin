%% -*- mode: erlang -*-
{erl_opts, [debug_info]}.
{plugins, [{coveralls, "1.3.0"},
           {rebar3_lint, "0.1.7"},
           {rebar3_elvis_plugin, {git, "https://github.com/deadtrickster/rebar3_elvis_plugin", {branch, "master"}}}]}.

{post_hooks, []}.

{deps, [{elvis_core, {git, "https://github.com/inaka/elvis_core.git", {ref, "6a05851"}}}]}.
{shell, [{apps, [rebar3_elvis_plugin]}]}.
{cover_enabled, true}.
{cover_export_enabled, true}.
{cover_excl_mods, [
                  ]}.

{coveralls_coverdata    , "_build/test/cover/eunit.coverdata"}.
{coveralls_service_name , "travis-ci"}.

{xref_extra_paths,[]}.
{xref_checks,[undefined_function_calls,undefined_functions,locals_not_used,
              deprecated_function_calls,deprecated_functions]}.

{profiles, [{docs, [{deps, [{edown, "0.8.1"}]},
                    {edoc_opts,
                     [{doclet, edown_doclet},
                      {dir, "doc"},
                      {subpackages, true},
                      {overview, "doc/overview.md"},
                      {top_level_readme,
                       {"./README.md",
                        "https://github.com/deadtrickster/rebar3_elvis_plugin"}}]}]},
            {benchmark, [{src_dirs, ["src", "benchmark"]},
                         {deps, [{'erlang-color',
                                  {git, "https://github.com/julianduque/erlang-color",
                                   {branch, "master"}}}]}]}]}.

{elvis, [#{dirs => [
                    "src"
                   ],
           filter => "*.erl",
           rules => [
                     {elvis_style, line_length,
                      #{limit => 80, skip_comments => false}},
                     {elvis_style, invalid_dynamic_call,
                      #{ignore => [
                                  ]}}
                    ],
           ruleset => erl_files
          },
         #{dirs => [
                    "test/eunit"
                   ],
           filter => "*.erl",
           rules => [
                     {elvis_style, line_length,
                      #{limit => 90}},
                     {elvis_style, invalid_dynamic_call,
                      #{ignore => [
                                  ]}},
                     {elvis_style, god_modules, #{limit => 40}},
                     %% looks like eunit generates underscored vars
                     {elvis_style, variable_naming_convention, #{regex => "^([A-Z_][0-9a-zA-Z_]*)$"}},
                     {elvis_style, dont_repeat_yourself, #{min_complexity => 200}}
                    ],
           ruleset => erl_files
          },
         #{dirs => ["."],
           filter => "Makefile",
           ruleset => makefiles
          },
         #{dirs => ["."],
           filter => "rebar.config",
           ruleset => rebar_config
          },
         #{dirs => ["."],
           filter => "elvis.config",
           ruleset => elvis_config
          }]}.
